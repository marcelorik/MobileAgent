import java.rmi.Naming;
import java.rmi.RemoteException;
import java.rmi.RMISecurityManager;
import java.rmi.server.UnicastRemoteObject;
import java.rmi.registry.*; 
import java.util.*;
 
public class AgenciaLancadora {
  
    private static HashMap<String, List<Integer>> mapAgencia = new HashMap<String, List<Integer>>();
 
    public static void fillOut(String nameRegistry,AgenciaI agencia){
    
       List<Integer> listServices = new ArrayList<Integer>();
       String[] tokens = (agencia.kindService()).split(",");
          for(String key : tokens) {
	   listServices.add(Integer.parseInt(key));
	}
       mapAgencia.put(nameRegistry,listServices); 
    }
 
 
    public static void main(String args[]) {
        System.out.println("Agência lançadora iniciando...");
	
        // Create and install a security manager
        if (System.getSecurityManager() == null) {
            System.setSecurityManager(new RMISecurityManager());
            System.out.println("Gerenciamento de segurança instalado com sucesso.");
        } else {
            System.out.println("Gerenciamento de segurança já existe.");
        }
 
        
        /*REGISTER - HOST*/
        try { //special exception handler for registry creation
            LocateRegistry.createRegistry(1099); //port number
            System.out.println("java RMI registry created.");
        } catch (RemoteException e) {
            //do nothing, error means registry already exists
            System.out.println("java RMI registry already exists.");
        }
 
        try {    
	  
	    //Instantiate RmiServer
            AgenciaI agenciaAlfa = new Agencia();
            String nameRegistry = "//localhost/RmiServer";
            
	    fillOut(nameRegistry,agenciaAlfa); 
	   
	    
            // Bind this object instance to the name "RmiServer"
            Naming.rebind(nameRegistry, agenciaAlfa);
            //System.out.println("Tipos serviços : " + agenciaAlfa.kindService());
            
            //Test lista de registros
            /*System.out.println("--------- names in registry ----------");
            String[] list;
            list = Naming.list("");
            for(String key: list) {
	      System.out.println(key);         
            }  */          
            //System.out.println("Valor do registry : " + LocateRegistry.getRegistry(1099));	   
           // System.out.println("--------------------------------------");
	    
	    System.out.println("\n\nPeerServer bound in registry");
       } catch (Exception e) {
            System.err.println("RMI server exception:" + e);
            e.printStackTrace();
        }
    }
        
}
